<source>
 @log_level fatal
 @type forward
 bind 0.0.0.0
 port 24224
</source>

<filter honeypot.dionaea>
    @type record_modifier
    remove_keys credentials

    <record>
        credentials ${if record.has_key?("credentials"); record["username"] = record["credentials"][0]["username"]; record["password"] = record["credentials"][0]["password"] ;end;nil}
    </record>
</filter>

# <filter honeypot.cowrie>
#     @type record_modifier
#     remove_keys username
#     remove_keys password

#     <record>
#         username ${if record.has_key?("username"); record["username"] = record["username"]; record["password"] = record["password"];end;nil}
#     </record>
# </filter>


# <filter honeypot.glastopf>
#     @type record_modifier
#     remove_keys credentials

#     <record>
#         credentials ${if record.has_key?("credentials"); record["username"] = record["credentials"][0]["username"]; record["password"] = record["credentials"][0]["password"] ;end;nil}
#     </record>
# </filter>

<match honeypot.**>

    # @type copy

    # <store>
    #     @type stdout
    # </store>

    # <store>
    #     @type mongo

    #     host mongodb
    #     port 27017

    #     capped
    #     capped_size 100m

    #     database fipro
    #     collection raw_log

    #     flush_interval 1s

    #     include_time_key true
    #     time_key timestamp
    # </store>

    # <store>
    @type mqtt
    
    host mqtt
    port 1883      
    client_id FLUENTD.HoneypotPublisher

    <security>
        username fluentd
        password rustygear125
    </security>

    keep_alive 15s

    <format>
        @type json
        add_newline false
    </format>
    <inject>
        time_key timestamp
    </inject>
    <buffer>
        flush_interval 1s
    </buffer>
    # </store>

</match>